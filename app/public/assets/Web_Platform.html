<p>"PROJECT DOCUMENTATION: GENAI WEB PLATFORM</p><br />
<hr /><br />
<p><strong>Part I: Getting Started</strong></p><br />
<p><strong>1. Introduction</strong><br />
1.1. What is GenAI Web Platform?<br />
1.2. Core Features &amp; Capabilities<br />
1.3. Who Is This For?<br />
1.4. Technology Stack</p><br />
<p><strong>2. Quick Start Guide</strong><br />
2.1. Your First 5 Minutes<br />
2.2. Running the Application Locally<br />
2.3. Key Concepts at a Glance</p><br />
<p><strong>3. Installation</strong><br />
3.1. Server Requirements &amp; Prerequisites<br />
3.2. Automated Installation (Recommended)<br />
3.3. Manual Installation (Advanced)<br />
3.4. Environment Configuration (<code>.env</code>)<br />
3.5. Post-Installation Steps &amp; Security</p><br />
<hr /><br />
<p><strong>Part II: Guides &amp; Tutorials</strong></p><br />
<p><strong>4. Core Concepts</strong><br />
4.1. Architectural Overview (Modular MVC-S)<br />
4.2. The Request Lifecycle<br />
4.3. Service Container &amp; Dependency Injection<br />
4.4. Directory Structure Explained<br />
4.5. Security Principles<br />
4.6. Frontend Design (The 'Blueprint' Method)</p><br />
<p><strong>5. Tutorial: Building Your First Feature</strong><br />
5.1. Creating a New Route<br />
5.2. Building the Controller &amp; Service<br />
5.3. Interacting with the Database (Model &amp; Entity)<br />
5.4. Displaying Data in a View</p><br />
<p><strong>6. Feature Guides (Deep Dives)</strong><br />
6.1. User Authentication<br />
6.1.1. Registration &amp; Login Flow<br />
6.1.2. Email Verification &amp; Password Resets<br />
6.1.3. Access Control with Filters<br />
6.2. Payment Gateway Integration<br />
6.2.1. Configuration<br />
6.2.2. Initiating a Transaction<br />
6.2.3. Verifying a Payment<br />
6.3. AI Service Integration<br />
6.3.1. Generative Text &amp; Multimodal Input<br />
6.3.2. Hybrid Memory System (Vector + Keyword)<br />
6.3.3. Text-to-Speech (TTS) &amp; Audio Processing<br />
6.3.4. Advanced Document Generation (Pandoc/XeTeX)<br />
6.3.5. User Settings (Voice &amp; Assistant Modes)<br />
6.4. Cryptocurrency Data Service<br />
6.4.1. Querying Balances<br />
6.4.2. Fetching Transaction Histories<br />
6.5. Administrative Dashboard<br />
6.5.1. User Management<br />
6.5.2. Sending Email Campaigns<br />
6.5.3. Viewing Application Logs<br />
6.6. Blog &amp; Content Management<br />
6.6.1. Public-Facing Blog<br />
6.6.2. Admin Management Interface<br />
6.7. Self-Hosted Documentation<br />
6.7.1. Serving Documentation Pages</p><br />
<hr /><br />
<p><strong>Part III: Technical Reference</strong></p><br />
<p><strong>7. Command-Line Interface (CLI)</strong><br />
7.1. Overview of Custom Commands<br />
7.2. <code>php spark train</code></p><br />
<p><strong>8. Configuration Reference</strong><br />
8.1. Application (<code>App.php</code>)<br />
8.2. Database (<code>Database.php</code>)<br />
8.3. Custom Configurations (<code>AGI.php</code>, <code>Recaptcha.php</code>)</p><br />
<p><strong>9. Testing</strong><br />
9.1. Running the Test Suite<br />
9.2. Writing Unit Tests<br />
9.3. Writing Feature Tests</p><br />
<hr /><br />
<p><strong>Part IV: Operations &amp; Community</strong></p><br />
<p><strong>10. Deployment</strong><br />
10.1. Production Server Setup<br />
10.2. Deployment Checklist<br />
10.3. Performance Optimization</p><br />
<p><strong>11. Troubleshooting</strong><br />
11.1. Frequently Asked Questions (FAQ)<br />
11.2. Common Error Resolutions<br />
11.3. Logging &amp; Debugging</p><br />
<p><strong>12. Contributing</strong><br />
12.1. Contribution Guidelines<br />
12.2. Code Style (PSR-12)<br />
12.3. Submitting a Pull Request</p><br />
<p><strong>13. Appendices</strong><br />
13.1. Glossary of Terms<br />
13.2. Changelog &amp; Release History</p><br />
<hr /><br />
<p><strong>Part V: Documentation Maintenance Guide</strong></p><br />
<p><strong>15. A Guide for the Project Owner</strong><br />
15.1. The Philosophy of Living Documentation<br />
15.2. Your Role vs. the AI's Role<br />
15.3. The Documentation Update Workflow<br />
15.4. Procedure: How to Review the Codebase for Changes<br />
15.5. Procedure: Updating the Changelog and Managing Releases</p><br />
<hr /><br />
<p><strong>Part I: Getting Started</strong></p><br />
<p><strong>1. Introduction</strong></p><br />
<p><strong>1.1. What is GenAI Web Platform?</strong></p><br />
<p>The GenAI Web Platform is a comprehensive, multi-functional application built on the CodeIgniter 4 framework. It is architected using a <strong>Modular MVC-S pattern</strong>, where each distinct business feature (like AI, Payments, or the Blog) is encapsulated in its own self-contained module for maximum maintainability. The platform serves as a portal for registered users to access a suite of powerful digital services, including AI-driven content generation, real-time cryptocurrency data queries, and robust user and content management capabilities. Designed with a modular architecture, it features a secure user authentication system, an account dashboard with an integrated balance and payment system (supporting M-Pesa, Airtel, and Card), a complete administrative panel for user oversight, and a fully integrated blog.</p><br />
<p><strong>1.2. Core Features &amp; Capabilities</strong></p><br />
<ul><br />
<li><strong>Modular Architecture:</strong> Core features like AI, Payments, Crypto, and Blog are isolated into self-contained modules for better organization and scalability.</li><br />
<li><strong>User Authentication:</strong> Secure registration, login, email verification, and password reset functionality.</li><br />
<li><strong>Payment Gateway Integration:</strong> Seamless payments via Paystack, a popular African payment gateway.</li><br />
<li><strong>AI Service Integration:</strong> Advanced text and multimedia interaction with Google's Gemini API. Features include a <strong>Hybrid Memory System</strong> (combining Vector embeddings and keyword search), <strong>Text-to-Speech</strong> output, and <strong>Professional Document Generation</strong> (PDF/Word) using LaTeX engines.</li><br />
<li><strong>Cryptocurrency Data Service:</strong> Real-time balance and transaction history queries for Bitcoin (BTC) and Litecoin (LTC) addresses.</li><br />
<li><strong>Blog &amp; Content Management:</strong> A public-facing blog with a full administrative backend for creating, editing, and managing posts.</li><br />
<li><strong>Administrative Dashboard:</strong> Robust tools for user management, balance adjustments, financial oversight, log viewing, and sending email campaigns to all users.</li><br />
<li><strong>Self-Hosted Documentation:</strong> The application serves its own documentation, which can be easily updated.</li><br />
<li><strong>Secure &amp; Performant:</strong> Built with modern security best practices and optimized for production environments.</li><br />
</ul><br />
<p><strong>1.3. Who Is This For?</strong></p><br />
<p>This platform is designed for developers, creators, and businesses, particularly in Kenya and the broader African market, who require a flexible, pay-as-you-go solution for accessing advanced AI and blockchain data services. It serves as both a functional application and a robust foundation for building more complex systems.</p><br />
<p><strong>1.4. Technology Stack</strong></p><br />
<ul><br />
<li><strong>Backend:</strong> PHP 8.2+, CodeIgniter 4</li><br />
<li><strong>Frontend:</strong> Bootstrap 5, JavaScript, HTML5, CSS3</li><br />
<li><strong>Database:</strong> MySQL 8.0+</li><br />
<li><strong>Web Server:</strong> Apache2</li><br />
<li><strong>Key Libraries:</strong><br />
<ul><br />
<li><code>google/gemini-php</code>: For interacting with the Gemini API.</li><br />
<li><code>dompdf/dompdf</code>: For PDF generation fallback.</li><br />
<li><code>nlp-tools/nlp-tools</code>: For Natural Language Processing (Naive Bayes classification).</li><br />
<li><code>php-ffmpeg/php-ffmpeg</code>: For audio conversion (PCM to MP3).</li><br />
</ul></li><br />
<li><strong>System Dependencies:</strong><br />
<ul><br />
<li><strong>Pandoc &amp; TeX Live (XeTeX):</strong> For high-fidelity PDF/Docx generation.</li><br />
<li><strong>FFmpeg:</strong> For audio processing.</li><br />
</ul></li><br />
<li><strong>Development &amp; Deployment:</strong> Composer, PHPUnit, Spark CLI, Git, Bash</li><br />
</ul><br />
<p><strong>2. Quick Start Guide</strong></p><br />
<p><strong>2.1. Your First 5 Minutes</strong></p><br />
<p>For a fresh Ubuntu server, the fastest way to get started is with the automated setup script.</p><br />
<ol><br />
<li>Clone the repository: <code>git clone https://github.com/nehemiaobati/genaiwebapplication.git</code></li><br />
<li>Navigate into the directory: <code>cd genaiwebapplication</code></li><br />
<li>Make the script executable: <code>chmod +x setup.sh</code></li><br />
<li>Run with sudo: <code>sudo ./setup.sh</code></li><br />
<li><strong>Important:</strong> The installation process may take several minutes as it installs robust PDF engines (TexLive).</li><br />
<li>After completion, edit the newly created <code>.env</code> file to add your <code>GEMINI_API_KEY</code>.</li><br />
</ol><br />
<p><strong>2.2. Running the Application Locally</strong></p><br />
<ol><br />
<li><strong>Clone the Repository:</strong> <code>git clone https://github.com/nehemiaobati/genaiwebapplication.git</code></li><br />
<li><strong>Install Dependencies:</strong> <code>composer install</code></li><br />
<li><strong>Create Environment File:</strong> Copy <code>env</code> to <code>.env</code> and configure your local database and <code>app.baseURL</code>.</li><br />
<li><strong>Run Migrations:</strong> <code>php spark migrate</code></li><br />
<li><strong>Create Writable Directories:</strong> Ensure <code>writable/uploads/gemini_temp</code>, <code>writable/uploads/ttsaudio_secure</code>, and <code>writable/nlp</code> exist.</li><br />
<li><strong>Start the Server:</strong> <code>php spark serve</code></li><br />
<li>Access the application at <code>http://localhost:8080</code>.</li><br />
</ol><br />
<p><strong>2.3. Key Concepts at a Glance</strong></p><br />
<ul><br />
<li><strong>Modular MVC-S Architecture:</strong> The application is built around self-contained Modules (e.g., <code>Gemini</code>, <code>Payments</code>).</li><br />
<li><strong>Services:</strong> Core functionality is encapsulated in service classes. For example, <code>GeminiService</code> handles API communication, while <code>FfmpegService</code> handles audio conversion.</li><br />
<li><strong>Pay-As-You-Go:</strong> Users top up an account balance, and this balance is debited for each AI interaction or Crypto query.</li><br />
</ul><br />
<p><strong>3. Installation</strong></p><br />
<p><strong>3.1. Server Requirements &amp; Prerequisites</strong></p><br />
<ul><br />
<li><strong>OS:</strong> Ubuntu 20.04/22.04 (Recommended)</li><br />
<li><strong>Web Server:</strong> Apache2</li><br />
<li><strong>PHP:</strong> Version <strong>8.2</strong> or higher. Required extensions: <code>intl</code>, <code>mbstring</code>, <code>bcmath</code>, <code>curl</code>, <code>xml</code>, <code>zip</code>, <code>gd</code>, <code>imagick</code>.</li><br />
<li><strong>Database:</strong> MySQL Server</li><br />
<li><strong>System Tools:</strong><br />
<ul><br />
<li><code>ffmpeg</code>: Required for Text-to-Speech functionality.</li><br />
<li><code>pandoc</code>: Required for document generation.</li><br />
<li><code>texlive-xetex</code>, <code>texlive-fonts-recommended</code>, <code>lmodern</code>: Required for generating PDFs via Pandoc.</li><br />
</ul></li><br />
</ul><br />
<p><strong>3.2. Automated Installation (Recommended)</strong></p><br />
<p>The <code>setup.sh</code> script is designed for a clean Ubuntu server and automates the entire installation process. It will:</p><br />
<ul><br />
<li>Install Apache2, PHP 8.2, MySQL, FFMpeg, and the full Pandoc/LaTeX stack.</li><br />
<li>Create a dedicated database and user.</li><br />
<li>Install Composer and Node.js.</li><br />
<li>Clone the project repository and install PHP dependencies.</li><br />
<li>Create the <code>.env</code> file with generated database credentials.</li><br />
<li>Create necessary subdirectories in <code>writable/</code> for temporary uploads and NLP models.</li><br />
<li>Run database migrations.</li><br />
<li>Configure an Apache virtual host.</li><br />
</ul><br />
<p><strong>Usage:</strong></p><br />
<pre><code>chmod +x setup.sh<br />
sudo ./setup.sh</code></pre><br />
<p><strong>3.3. Manual Installation (Advanced)</strong></p><br />
<ol><br />
<li><strong>Clone Repository:</strong> <code>git clone https://github.com/nehemiaobati/genaiwebapplication.git .</code></li><br />
<li><strong>Install Dependencies:</strong> Run <code>composer install</code>.</li><br />
<li><strong>System Dependencies:</strong> Manually install <code>ffmpeg</code>, <code>pandoc</code>, and <code>texlive-xetex</code>.</li><br />
<li><strong>Configure Environment:</strong> Copy <code>env</code> to <code>.env</code>.</li><br />
<li><strong>Database Setup:</strong> Create a MySQL database and user.</li><br />
<li><strong>Edit <code>.env</code> file:</strong> Fill in your <code>app.baseURL</code>, database credentials, <code>GEMINI_API_KEY</code>, and payment keys.</li><br />
<li><strong>Run Migrations:</strong> Run <code>php spark migrate</code> to create all necessary tables (including <code>interactions</code>, <code>entities</code>, <code>user_settings</code>).</li><br />
<li><strong>Set Permissions:</strong> Ensure the <code>writable/</code> directory is writable by the web server. Specifically ensure <code>writable/uploads</code> and <code>writable/nlp</code> are writable.</li><br />
<li><strong>Configure Web Server:</strong> Point your web server's document root to the project's <code>public/</code> directory.</li><br />
</ol><br />
<p><strong>3.4. Environment Configuration (<code>.env</code>)</strong></p><br />
<p>The <code>.env</code> file is critical for configuring the application. You must fill in the following values:</p><br />
<ul><br />
<li><code>CI_ENVIRONMENT</code>: <code>development</code> for local, <code>production</code> for live.</li><br />
<li><code>GEMINI_API_KEY</code>: <strong>(Required)</strong> Your API key for Google Gemini.</li><br />
<li><code>PAYSTACK_SECRET_KEY</code>: Your secret key from your Paystack dashboard.</li><br />
<li><code>encryption.key</code>: A unique, 32-character random string (generated by setup script).</li><br />
<li><code>recaptcha_siteKey</code> &amp; <code>recaptcha_secretKey</code>: Your keys for Google reCAPTCHA v2.</li><br />
</ul><br />
<p><strong>3.5. Post-Installation Steps &amp; Security</strong></p><br />
<ol><br />
<li><strong>Secure <code>.env</code>:</strong> Ensure the <code>.env</code> file is never committed to version control.</li><br />
<li><strong>Directory Security:</strong> The <code>writable/uploads/ttsaudio_secure</code> directory contains generated user audio. Access to this is controlled via the <code>GeminiController::serveAudio</code> method to prevent unauthorized access.</li><br />
<li><strong>Enable HTTPS:</strong> For production, install an SSL certificate using Certbot.</li><br />
</ol><br />
<hr /><br />
<p><strong>Part II: Guides &amp; Tutorials</strong></p><br />
<p><strong>4. Core Concepts</strong></p><br />
<p><strong>4.1. Architectural Overview (Modular MVC-S)</strong></p><br />
<p>The project's primary architecture is <strong>Modular</strong>. Each distinct business feature (e.g., Blog, Payments, Gemini) is isolated into a self-contained module within the <code>app/Modules/</code> directory. This promotes code organization, reusability, and makes features easy to add or remove.</p><br />
<p>Within each module (and for core shared components in the <code>app/</code> directory), the project follows a <strong>Model-View-Controller-Service (MVC-S)</strong> pattern.</p><br />
<ul><br />
<li><strong>Models (<code>app/Modules/[ModuleName]/Models</code>)</strong>: Handle all direct database interactions for that module.</li><br />
<li><strong>Views (<code>app/Modules/[ModuleName]/Views</code>)</strong>: Contain the presentation logic (HTML) for the module.</li><br />
<li><strong>Controllers (<code>app/Modules/[ModuleName]/Controllers</code>)</strong>: Act as the bridge, handling HTTP requests for the module, calling services, and passing data to views.</li><br />
<li><strong>Services (<code>app/Modules/[ModuleName]/Libraries</code>)</strong>: Contain the core business logic specific to that module. For example, <code>MemoryService</code> resides in <code>App\Modules\Gemini\Libraries</code>.</li><br />
</ul><br />
<p><strong>4.2. The Request Lifecycle</strong></p><br />
<p>Standard CodeIgniter 4 lifecycle applies. Routes are defined in <code>app/Modules/[ModuleName]/Config/Routes.php</code>. Filters like <code>AuthFilter</code> and <code>BalanceFilter</code> protect routes and ensure users have funds before accessing AI services.</p><br />
<p><strong>4.3. Service Container &amp; Dependency Injection</strong></p><br />
<p>The application uses CodeIgniter's service container to manage class instances. Core services are defined in <code>app/Config/Services.php</code>. This allows for easy instantiation and sharing of service objects throughout the application.</p><br />
<ul><br />
<li><strong>Example:</strong> <code>$geminiService = service('geminiService');</code></li><br />
<li><strong>Example:</strong> <code>$ffmpegService = service('ffmpegService');</code></li><br />
</ul><br />
<p><strong>4.4. Directory Structure Explained</strong></p><br />
<ul><br />
<li><code>app/Modules/Gemini/</code>:<br />
<ul><br />
<li><code>Libraries/</code>: Contains <code>GeminiService</code>, <code>MemoryService</code>, <code>EmbeddingService</code>, <code>FfmpegService</code>, <code>PandocService</code>, <code>TokenService</code>, <code>TrainingService</code>.</li><br />
<li><code>Models/</code>: Contains <code>InteractionModel</code>, <code>EntityModel</code>, <code>PromptModel</code>, <code>UserSettingsModel</code>.</li><br />
</ul></li><br />
<li><code>writable/nlp/</code>: Stores trained Naive Bayes models (<code>classifier.model</code>).</li><br />
<li><code>writable/uploads/</code>: Stores temporary media, PDF generation artifacts, and secure audio files.</li><br />
</ul><br />
<p><strong>4.5. Security Principles</strong></p><br />
<ul><br />
<li><strong>Public Webroot:</strong> The server's document root is set to the <code>public/</code> directory.</li><br />
<li><strong>Input Sanitization:</strong> <code>TokenService</code> strips HTML tags and normalizes text before processing for memory.</li><br />
<li><strong>Secure File Serving:</strong> Generated MP3s are stored outside the <code>public</code> root and served via a controller method (<code>serveAudio</code>) that verifies user ownership.</li><br />
<li><strong>CSRF Protection:</strong> Cross-Site Request Forgery tokens are used on all POST forms.</li><br />
</ul><br />
<p><strong>4.6. Frontend Design (The 'Blueprint' Method)</strong></p><br />
<p>The project follows a strict frontend workflow called the "Blueprint Method" to ensure UI consistency. New features include <code>prompt-card</code> styling and progress bars for file uploads in the AI Studio.</p><br />
<p><strong>5. Tutorial: Building Your First Feature</strong></p><br />
<p>This tutorial demonstrates how to build a simple "Notes" feature. <strong>Note:</strong> According to the project's modular architecture, this feature should ideally be built inside its own module at <code>app/Modules/Notes/</code>.</p><br />
<p><strong>5.1. Creating a New Route</strong></p><br />
<p>Open <code>app/Modules/Notes/Config/Routes.php</code> and add routes.</p><br />
<pre><code>$routes-&gt;group('notes', ['filter' =&gt; 'auth', 'namespace' =&gt; 'App\Modules\Notes\Controllers'], static function ($routes) {<br />
    $routes-&gt;get('/', 'NoteController::index', ['as' =&gt; 'notes.index']);<br />
    $routes-&gt;post('create', 'NoteController::create', ['as' =&gt; 'notes.create']);<br />
});</code></pre><br />
<p><strong>5.2. Building the Controller &amp; Service</strong></p><br />
<ol><br />
<li><strong>Create the Controller:</strong> <code>php spark make:controller Modules/Notes/NoteController</code></li><br />
<li><br />
<p>Edit <code>app/Modules/Notes/Controllers/NoteController.php</code>:</p><br />
<pre><code>&lt;?php<br />
namespace App\Modules\Notes\Controllers;<br />
<br />
use App\Controllers\BaseController;<br />
<br />
class NoteController extends BaseController<br />
{<br />
    public function index()<br />
    {<br />
        $noteModel = new \App\Modules\Notes\Models\NoteModel();<br />
        $data['notes'] = $noteModel-&gt;where('user_id', session()-&gt;get('userId'))-&gt;findAll();<br />
        return view('App\Modules\Notes\Views\index', $data);<br />
    }<br />
<br />
    public function create()<br />
    {<br />
        // ... (logic to save note) ...<br />
        return redirect()-&gt;to(url_to('notes.index'))-&gt;with('success', 'Note saved!');<br />
    }<br />
}</code></pre><br />
</li><br />
</ol><br />
<p><strong>5.3. Interacting with the Database (Model &amp; Entity)</strong></p><br />
<ol><br />
<li><strong>Create a Migration:</strong> <code>php spark make:migration Modules/Notes/create_notes_table</code></li><br />
<li><strong>Create the Model:</strong> <code>php spark make:model Modules/Notes/NoteModel</code></li><br />
<li><strong>Create the Entity:</strong> <code>php spark make:entity Modules/Notes/Note</code></li><br />
</ol><br />
<p><strong>5.4. Displaying Data in a View</strong></p><br />
<p>Create <code>app/Modules/Notes/Views/index.php</code>.</p><br />
<pre><code>&lt;?= $this-&gt;extend('layouts/default') ?&gt;<br />
&lt;?= $this-&gt;section('content') ?&gt;<br />
&lt;div class="container my-5"&gt;<br />
    &lt;h1&gt;My Notes&lt;/h1&gt;<br />
    &lt;!-- Form and list of notes --&gt;<br />
&lt;/div&gt;<br />
&lt;?= $this-&gt;endSection() ?&gt;</code></pre><br />
<p><strong>6. Feature Guides (Deep Dives)</strong></p><br />
<p><strong>6.1. User Authentication</strong></p><br />
<ul><br />
<li><strong>6.1.1. Registration &amp; Login Flow</strong>: Managed by <code>AuthController.php</code>, this feature handles user registration with validation and reCAPTCHA, credential verification for login, and session management.</li><br />
<li><strong>6.1.2. Email Verification &amp; Password Resets</strong>: A unique token is generated and emailed to the user for verification. The password reset flow uses a secure, expiring token sent via email.</li><br />
<li><strong>6.1.3. Access Control with Filters</strong>: The <code>AuthFilter</code> (<code>app/Filters/AuthFilter.php</code>) is applied to routes to protect pages that require a user to be logged in.</li><br />
</ul><br />
<p><strong>6.2. Payment Gateway Integration</strong></p><br />
<ul><br />
<li><strong>6.2.1. Configuration</strong>: The Paystack secret key is configured in the <code>.env</code> file (<code>PAYSTACK_SECRET_KEY</code>).</li><br />
<li><strong>6.2.2. Initiating a Transaction</strong>: <code>PaymentsController::initiate()</code> calls <code>PaystackService::initializeTransaction()</code>. The service sends a request to Paystack, which returns a unique authorization URL. The user is then redirected to this URL.</li><br />
<li><strong>6.2.3. Verifying a Payment</strong>: After payment, Paystack redirects the user back to the application. <code>PaymentsController::verify()</code> uses <code>PaystackService::verifyTransaction()</code> to confirm the payment status. If successful, the user's balance is updated within a database transaction.</li><br />
</ul><br />
<p><strong>6.3. AI Service Integration</strong></p><br />
<p>This module (<code>App\Modules\Gemini</code>) is the core of the platform.</p><br />
<ul><br />
<li><strong>6.3.1. Generative Text &amp; Multimodal Input</strong>: <code>GeminiController::generate()</code> accepts text prompts and uploaded files (images/PDFs). It uses <code>GeminiService</code> to communicate with models like <code>gemini-2.0-flash</code>. The system calculates token usage and deducts cost from the user's balance in real-time.</li><br />
<li><strong>6.3.2. Hybrid Memory System (Vector + Keyword)</strong>: Managed by <code>MemoryService.php</code>.<br />
<ul><br />
<li><strong>Storage:</strong> Interactions are stored in the <code>interactions</code> table. Entities (keywords) are stored in <code>entities</code>.</li><br />
<li><strong>Retrieval:</strong> The system uses <code>EmbeddingService</code> to get vector embeddings of the user's query. It performs a cosine similarity search (Semantic) AND a keyword-based search (Lexical).</li><br />
<li><strong>Fusion:</strong> Results are fused using a weighted algorithm (Alpha 0.5) to provide context that is both conceptually similar and keyword-relevant.</li><br />
<li><strong>Short-Term Memory:</strong> The system forces the retrieval of the most recent interactions (configurable via <code>AGI.php</code>) to maintain immediate conversational flow.</li><br />
</ul></li><br />
<li><strong>6.3.3. Text-to-Speech (TTS) &amp; Audio Processing</strong>:<br />
<ul><br />
<li><strong>Generation:</strong> If <code>voice_output_enabled</code> is true, <code>GeminiService</code> requests audio data from the API.</li><br />
<li><strong>Conversion:</strong> The API returns raw PCM data. <code>FfmpegService</code> converts this raw data into a web-compatible MP3 file using the <code>ffmpeg</code> binary installed on the server.</li><br />
</ul></li><br />
<li><strong>6.3.4. Advanced Document Generation (Pandoc/XeTeX)</strong>:<br />
<ul><br />
<li><strong>Primary Method:</strong> <code>DocumentService</code> uses <code>PandocService</code> to convert Markdown/HTML to PDF using the <code>xelatex</code> engine. This supports complex formatting.</li><br />
<li><strong>Fallback:</strong> If Pandoc fails, the system falls back to <code>Dompdf</code> for PDF generation.</li><br />
</ul></li><br />
<li><strong>6.3.5. User Settings (Voice &amp; Assistant Modes)</strong>:<br />
<ul><br />
<li>Users can toggle "Conversational Memory" and "Voice Output" directly from the UI.</li><br />
<li>These preferences are stored in the <code>user_settings</code> table and persist across sessions.</li><br />
</ul></li><br />
</ul><br />
<p><strong>6.4. Cryptocurrency Data Service</strong></p><br />
<ul><br />
<li><strong>6.4.1. Querying Balances</strong>: <code>CryptoController::query()</code> calls <code>CryptoService</code> methods, which make API calls to a third-party blockchain explorer.</li><br />
<li><strong>6.4.2. Fetching Transaction Histories</strong>: The controller calls <code>CryptoService</code> to fetch transaction data, which is then formatted for the view.</li><br />
</ul><br />
<p><strong>6.5. Administrative Dashboard</strong></p><br />
<ul><br />
<li><strong>6.5.1. User Management</strong>: <code>AdminController.php</code> provides methods to list, search, view details, update balances, and delete users.</li><br />
<li><strong>6.5.2. Sending Email Campaigns</strong>: <code>CampaignController.php</code> allows an administrator to compose an email that is sent to every registered user. It also provides functionality to save, load, and delete campaign templates.</li><br />
<li><strong>6.5.3. Viewing Application Logs</strong>: <code>AdminController::logs()</code> provides a secure interface for administrators to view and select daily log files from the <code>writable/logs/</code> directory for debugging purposes.</li><br />
</ul><br />
<p><strong>6.6. Blog &amp; Content Management</strong></p><br />
<ul><br />
<li><strong>6.6.1. Public-Facing Blog</strong>: <code>BlogController.php</code> (in the <code>Blog</code> module) handles the public-facing side, including a paginated index of all published posts and individual post views.</li><br />
<li><strong>6.6.2. Admin Management Interface</strong>: The <code>BlogController</code> also contains admin-only methods for managing content, providing a full CRUD (Create, Read, Update, Delete) interface for posts.</li><br />
</ul><br />
<p><strong>6.7. Self-Hosted Documentation</strong></p><br />
<ul><br />
<li><strong>6.7.1. Serving Documentation Pages</strong>: <code>DocumentationController.php</code> serves documentation pages. It includes methods to display the main documentation index and separate pages for different aspects of the project, such as web architecture and the AI system.</li><br />
</ul><br />
<hr /><br />
<p><strong>Part III: Technical Reference</strong></p><br />
<p><strong>7. Command-Line Interface (CLI)</strong></p><br />
<p><strong>7.1. Overview of Custom Commands</strong></p><br />
<p>Custom application commands are located in <code>app/Commands/</code> or <code>app/Modules/[ModuleName]/Commands/</code>.</p><br />
<p><strong>7.2. <code>php spark train</code></strong></p><br />
<ul><br />
<li><strong>Purpose:</strong> To run the NLP training service for text classification tasks.</li><br />
<li><strong>Action:</strong> Invokes <code>TrainingService::train()</code>. It reads training data, processes it via <code>TokenService</code>, trains a Naive Bayes classifier using the <code>nlp-tools</code> library, and serializes the resulting models to <code>writable/nlp/feature_factory.model</code> and <code>writable/nlp/classifier.model</code>.</li><br />
</ul><br />
<p><strong>8. Configuration Reference</strong></p><br />
<p><strong>8.1. Application (<code>App.php</code>)</strong></p><br />
<p>Located at <code>app/Config/App.php</code>, this file contains the base configuration for the application.</p><br />
<p><strong>8.2. Database (<code>Database.php</code>)</strong></p><br />
<p>Located at <code>app/Config/Database.php</code>, this file defines the database connection parameters.</p><br />
<p><strong>8.3. Custom Configurations (<code>AGI.php</code>, <code>Recaptcha.php</code>)</strong></p><br />
<p>Custom configuration files are placed in <code>app/Config/Custom/</code> or <code>app/Modules/Gemini/Config/AGI.php</code>.</p><br />
<ul><br />
<li><code>AGI.php</code>: Contains settings for the AI service, including:<br />
<ul><br />
<li><strong>Memory Logic:</strong> <code>rewardScore</code>, <code>decayScore</code>, <code>pruningThreshold</code>.</li><br />
<li><strong>Search Tuning:</strong> <code>hybridSearchAlpha</code> (balance between vector and keyword search).</li><br />
<li><strong>NLP:</strong> <code>nlpStopWords</code> (list of words to ignore during keyword extraction).</li><br />
</ul></li><br />
<li><code>Recaptcha.php</code>: Stores the site and secret keys for the Google reCAPTCHA service.</li><br />
</ul><br />
<p><strong>9. Testing</strong></p><br />
<p><strong>9.1. Running the Test Suite</strong></p><br />
<p>The project uses PHPUnit. Run the test suite using <code>composer test</code>.</p><br />
<p><strong>9.2. Writing Unit Tests</strong></p><br />
<p>Unit tests focus on testing individual classes in isolation and are placed in the <code>tests/</code> directory.</p><br />
<p><strong>9.3. Writing Feature Tests</strong></p><br />
<p>Feature tests test a full request-response cycle, simulating user interaction.</p><br />
<hr /><br />
<p><strong>Part IV: Operations &amp; Community</strong></p><br />
<p><strong>10. Deployment</strong></p><br />
<p><strong>10.1. Production Server Setup</strong></p><br />
<p>The <code>setup.sh</code> script provides a complete, automated setup for a production-ready Ubuntu server. <strong>Note:</strong> Ensure your server has at least 2GB of RAM to handle the compilation of PDF documents and FFMpeg conversions.</p><br />
<p><strong>10.2. Deployment Checklist</strong></p><br />
<ol><br />
<li>Set <code>CI_ENVIRONMENT</code> to <code>production</code> in your <code>.env</code> file.</li><br />
<li>Install production-only dependencies: <code>composer install --no-dev --optimize-autoloader</code>.</li><br />
<li>Run database migrations: <code>php spark migrate</code>.</li><br />
<li>Ensure <code>ffmpeg</code> and <code>pandoc</code> are in the system PATH.</li><br />
<li>Verify that <code>writable/</code> directory (especially <code>writable/uploads</code> and <code>writable/nlp</code>) has the correct server permissions.</li><br />
</ol><br />
<p><strong>10.3. Performance Optimization</strong></p><br />
<ul><br />
<li><strong>Caching:</strong> The application is configured to use Redis with a file-based fallback.</li><br />
<li><strong>Autoloader Optimization:</strong> The <code>--optimize-autoloader</code> flag creates an optimized class map.</li><br />
<li><strong>Memory Pruning:</strong> The <code>MemoryService</code> automatically prunes old interactions when the threshold (default: 500) is reached to keep database queries fast.</li><br />
</ul><br />
<p><strong>11. Troubleshooting</strong></p><br />
<p><strong>11.1. Frequently Asked Questions (FAQ)</strong></p><br />
<ul><br />
<li><strong>Why is PDF generation slow?</strong> The system uses LaTeX for high-quality rendering. This is resource-intensive.</li><br />
<li><strong>Why is there no audio?</strong> Ensure <code>voice_output_enabled</code> is checked and that <code>ffmpeg</code> is installed on the server.</li><br />
</ul><br />
<p><strong>11.2. Common Error Resolutions</strong></p><br />
<ul><br />
<li><strong>"Pandoc command not found"</strong>: Re-run the setup script or manually install <code>pandoc</code> and <code>texlive-xetex</code>.</li><br />
<li><strong>"Conversion failed" (Audio)</strong>: Check web server logs. Usually implies <code>ffmpeg</code> is missing or <code>writable/uploads/ttsaudio_secure</code> is not writable.</li><br />
</ul><br />
<p><strong>11.3. Logging &amp; Debugging</strong></p><br />
<ul><br />
<li><strong>Log Location:</strong> All application logs are stored in <code>writable/logs/</code>, with a new file created daily.</li><br />
<li><strong>Critical Errors:</strong> Failures in FFMpeg or Pandoc are logged as 'critical' or 'error' level for easy identification.</li><br />
</ul><br />
<p><strong>12. Contributing</strong></p><br />
<p><strong>12.1. Contribution Guidelines</strong></p><br />
<ol><br />
<li>Fork the repository.</li><br />
<li>Create a new feature branch.</li><br />
<li>Commit your changes.</li><br />
<li>Push to the branch.</li><br />
<li>Open a Pull Request.</li><br />
</ol><br />
<p><strong>12.2. Code Style (PSR-12)</strong></p><br />
<p>The project enforces the PSR-12 coding standard.</p><br />
<p><strong>12.3. Submitting a Pull Request</strong></p><br />
<p>Ensure your code is well-documented, follows the project's architectural patterns, and that all tests pass.</p><br />
<p><strong>13. Appendices</strong></p><br />
<p><strong>13.1. Glossary of Terms</strong></p><br />
<ul><br />
<li><strong>Module:</strong> A self-contained directory in <code>app/Modules/</code> that encapsulates a single business feature.</li><br />
<li><strong>Embeddings:</strong> Numerical representations of text used for semantic search.</li><br />
<li><strong>Hybrid Search:</strong> A search technique combining vector similarity and keyword matching.</li><br />
<li><strong>PCM:</strong> Pulse-Code Modulation, a raw audio format returned by Gemini API.</li><br />
</ul><br />
<p><strong>13.2. Changelog &amp; Release History</strong></p><br />
<p><strong>v1.3.0 - 2025-11-21</strong></p><br />
<h3>Added</h3><br />
<ul><br />
<li><strong>Text-to-Speech (TTS):</strong> Integrated Gemini Audio capabilities. Users can now hear AI responses.</li><br />
<li><strong>FFmpeg Integration:</strong> Added <code>FfmpegService</code> to convert raw AI audio to web-ready MP3s.</li><br />
<li><strong>Hybrid Memory System:</strong> Upgraded memory to use both Vector Embeddings and Keyword extraction for better context retrieval.</li><br />
<li><strong>User Settings:</strong> Added persistent toggles for "Assistant Mode" and "Voice Output".</li><br />
<li><strong>Setup Script:</strong> Major overhaul to <code>setup.sh</code> to include <code>texlive</code>, <code>ffmpeg</code>, and <code>pandoc</code> dependencies.</li><br />
</ul><br />
<h3>Changed</h3><br />
<ul><br />
<li><strong>Document Generation:</strong> Now uses <code>XeTeX</code> engine via Pandoc for professional-grade PDF output.</li><br />
<li><strong>Gemini Service:</strong> Refactored to support <code>gemini-2.0-flash</code> and <code>gemini-2.0-flash-lite</code>.</li><br />
<li><strong>Memory Logic:</strong> Added "Recency Bias" to force the inclusion of the last 3 interactions in context.</li><br />
</ul><br />
<p><strong>v1.2.0 - 2025-11-14</strong></p><br />
<h3>Added</h3><br />
<ul><br />
<li><strong>Modular Architecture:</strong> Refactored the entire application into a modular structure. Features like Blog, Payments, Crypto, and Gemini are now self-contained in <code>app/Modules/</code>.</li><br />
<li><strong>Campaign Templates:</strong> Administrators can now save, load, and delete email campaign templates.</li><br />
<li><strong>Admin Log Viewer:</strong> Added a new page in the admin dashboard to securely view application log files.</li><br />
<li><strong>Self-Hosted Documentation Pages:</strong> The application now serves dedicated pages for Web and AGI documentation.</li><br />
</ul><br />
<h3>Changed</h3><br />
<ul><br />
<li><strong>Document Generation:</strong> The AI document download feature now uses Pandoc for higher quality output and falls back to Dompdf for PDFs if Pandoc is not available.</li><br />
<li><strong>Directory Structure:</strong> Major changes to the directory structure to support the new modular architecture.</li><br />
<li><strong>Frontend Workflow:</strong> Standardized all views to use the "Blueprint" method for UI consistency.</li><br />
</ul><br />
<p><strong>v1.1.0 - 2025-11-13</strong></p><br />
<h3>Added</h3><br />
<ul><br />
<li><strong>Blog &amp; Content Management System:</strong> Added a complete public-facing blog and an administrative backend for full CRUD functionality.</li><br />
<li><strong>AI Document Generation:</strong> Users can download generated AI content as a PDF or Microsoft Word (<code>.docx</code>) file.</li><br />
</ul><br />
<h3>Changed</h3><br />
<ul><br />
<li>Updated routing to include endpoints for the new blog and documentation features.</li><br />
</ul><br />
<p><strong>v1.0.0 (Initial Release)</strong></p><br />
<ul><br />
<li>Core features implemented: User Authentication, Paystack Payments, Gemini AI Integration, Crypto Data Service, Admin Dashboard.</li><br />
</ul><br />
<hr /><br />
<p><strong>Part V: Documentation Maintenance Guide</strong></p><br />
<p><strong>15. A Guide for the Project Owner</strong></p><br />
<p>This section serves as the standard operating procedure (SOP) for maintaining this project's documentation. Its purpose is to ensure accuracy, consistency, and longevity, whether updates are performed by you or an AI assistant.</p><br />
<p><strong>15.1. The Philosophy of Living Documentation</strong></p><br />
<p>Treat this documentation as a core part of the codebase. It should evolve in lockstep with every feature change, bug fix, or architectural adjustment. An undocumented change is an incomplete change. The goal is to ensure that a new developer, or you in six months, can understand the <em>what</em>, <em>how</em>, and <em>why</em> of the system just by reading this document.</p><br />
<p><strong>15.2. Your Role vs. the AI's Role</strong></p><br />
<ul><br />
<li><strong>The AI's Role (Efficiency &amp; Accuracy):</strong> The AI is the primary documentation writer. It excels at systematically analyzing code changes (<code>git diff</code>), identifying affected components, and generating accurate, detailed descriptions based on the established structure. It is responsible for the heavy lifting of drafting content.</li><br />
<li><strong>Your Role (Clarity &amp; Context):</strong> Your role is that of an editor and strategist. You review the AI-generated content for clarity, human readability, and high-level context that the code alone cannot provide. You ensure the "why" behind a change is captured, not just the "what."</li><br />
</ul><br />
<p><strong>15.3. The Documentation Update Workflow</strong></p><br />
<p>This workflow applies to any code changes committed to the main branch.</p><br />
<p><strong>A. For Simple Changes (e.g., typos, clarifications, minor updates):</strong></p><br />
<ol><br />
<li><strong>Identify:</strong> Locate the relevant section in the documentation file.</li><br />
<li><strong>Edit:</strong> Make the necessary correction or addition directly.</li><br />
<li><strong>Commit:</strong> Commit the change with a clear message, prefixed with <code>docs:</code>.<br />
<ul><br />
<li><em>Example:</em> <code>docs: Correct typo in Installation section 3.4</code></li><br />
</ul></li><br />
</ol><br />
<p><strong>B. For Complex Changes (e.g., new features, architectural modifications):</strong></p><br />
<ol><br />
<li><strong>Identify the Scope:</strong> Use the procedure in section <strong>15.4</strong> to identify all changed files and map them to the corresponding sections of this documentation.</li><br />
<li><strong>Draft Updates (or Prompt the AI):</strong> For each affected section, draft the new content. If using the AI, provide it with the list of changed files and instruct it to update the documentation accordingly.<br />
<ul><br />
<li><em>Example Prompt for AI:</em> "A new email campaign feature has been added. The following files were created or modified: <code>CampaignController.php</code>, <code>CampaignModel.php</code>, <code>create.php</code> view, and the routes were updated. Please update the documentation, including a new sub-section in the Feature Guides (6.5.2) and updating the directory structure."</li><br />
</ul></li><br />
<li><strong>Update Table of Contents:</strong> If new sections or sub-sections were added, update the table of contents at the beginning of the document.</li><br />
<li><strong>Update Changelog:</strong> Follow the procedure in section <strong>15.5</strong> to add an entry to the Changelog and determine if the version number needs to be updated.</li><br />
<li><strong>Review and Commit:</strong> Read through all changes from the perspective of someone unfamiliar with the update. Is it clear? Is anything missing? Once satisfied, commit the changes.</li><br />
</ol><br />
<p><strong>15.4. Procedure: How to Review the Codebase for Changes</strong></p><br />
<p>The most efficient way to find what needs documenting is by analyzing the difference between your feature branch and the main branch using Git.</p><br />
<ol><br />
<li><br />
<p><strong>Generate a File List:</strong> From your feature branch, run the following command to get a list of all files that have been added (<code>A</code>), modified (<code>M</code>), or renamed (<code>R</code>):</p><br />
<pre><code>git diff main --name-status  &gt; changed_files.txt<br />
git diff main &gt; code_changes.diff</code></pre><br />
</li><br />
<li><br />
<p><strong>Map Files to Documentation Sections:</strong> Use the output from the command above and this checklist to determine which parts of the documentation to review and update.</p><br />
</li><br />
</ol><br />
<table><br />
<thead><br />
<tr><br />
<th style="text-align:left;">If This File/Directory Changed...</th><br />
<th style="text-align:left;">...Then Review and Update These Documentation Sections</th><br />
</tr><br />
</thead><br />
<tbody><br />
<tr><br />
<td style="text-align:left;"><code>setup.sh</code> or <code>.env</code> (new variables)</td><br />
<td style="text-align:left;"><strong>3. Installation</strong> (Prerequisites, Automated/Manual Setup, Environment Config)</td><br />
</tr><br />
<tr><br />
<td style="text-align:left;"><code>app/Modules/[ModuleName]/Config/Routes.php</code></td><br />
<td style="text-align:left;"><strong>5. Tutorial</strong>, <strong>6. Feature Guides</strong> (for new endpoints/URLs)</td><br />
</tr><br />
<tr><br />
<td style="text-align:left;"><code>app/Modules/[ModuleName]/Controllers/*</code></td><br />
<td style="text-align:left;"><strong>6. Feature Guides</strong> (logic for a specific feature)</td><br />
</tr><br />
<tr><br />
<td style="text-align:left;"><code>app/Modules/[ModuleName]/Libraries/*</code> (Services)</td><br />
<td style="text-align:left;"><strong>4. Core Concepts</strong>, <strong>6. Feature Guides</strong> (detailed business logic)</td><br />
</tr><br />
<tr><br />
<td style="text-align:left;"><code>app/Modules/[ModuleName]/Models/*</code> or <code>Entities/*</code></td><br />
<td style="text-align:left;"><strong>5. Tutorial</strong>, <strong>6. Feature Guides</strong> (how data is handled for a feature)</td><br />
</tr><br />
<tr><br />
<td style="text-align:left;"><code>app/Modules/[ModuleName]/Database/Migrations/*</code></td><br />
<td style="text-align:left;"><strong>5. Tutorial</strong>, <strong>6. Feature Guides</strong> (mention new database tables/columns)</td><br />
</tr><br />
<tr><br />
<td style="text-align:left;"><code>app/Commands/*</code> or <code>app/Modules/[ModuleName]/Commands/*</code></td><br />
<td style="text-align:left;"><strong>7. Command-Line Interface (CLI)</strong></td><br />
</tr><br />
<tr><br />
<td style="text-align:left;"><code>app/Config/Custom/*</code></td><br />
<td style="text-align:left;"><strong>8. Configuration Reference</strong> (document new custom settings)</td><br />
</tr><br />
<tr><br />
<td style="text-align:left;"><code>app/Modules/[ModuleName]/Views/*</code></td><br />
<td style="text-align:left;">Usually doesn't require a doc change unless a major new UI feature is introduced.</td><br />
</tr><br />
<tr><br />
<td style="text-align:left;"><code>composer.json</code> (new dependencies)</td><br />
<td style="text-align:left;"><strong>1.4. Technology Stack</strong>, <strong>3.1. Server Requirements</strong></td><br />
</tr><br />
</tbody><br />
</table><br />
<p><strong>15.5. Procedure: Updating the Changelog and Managing Releases</strong></p><br />
<p>This project follows <strong>Semantic Versioning (SemVer)</strong>: <code>MAJOR.MINOR.PATCH</code>.</p><br />
<ul><br />
<li><strong><code>PATCH</code> (e.g., 1.0.0 -&gt; 1.0.1):</strong> For backward-compatible bug fixes or documentation corrections. No new features.</li><br />
<li><strong><code>MINOR</code> (e.g., 1.0.1 -&gt; 1.1.0):</strong> For new features or functionality added in a backward-compatible manner. This will be your most common version bump.</li><br />
<li><strong><code>MAJOR</code> (e.g., 1.1.0 -&gt; 2.0.0):</strong> For incompatible API changes or significant architectural shifts that break backward compatibility.</li><br />
</ul><br />
<p><strong>Changelog Update Criteria:</strong></p><br />
<ol><br />
<li><br />
<p><strong>Locate the Changelog:</strong> Find section <strong>13.2. Changelog &amp; Release History</strong>.</p><br />
</li><br />
<li><br />
<p><strong>Create a New Entry:</strong> For every set of changes merged to <code>main</code>, add a new version heading. If it's the first change for a new version, create the heading; otherwise, add to the existing one.</p><br />
</li><br />
<li><br />
<p><strong>Format the Entry:</strong> Use the following structure, inspired by Keep a Changelog (<a href="https://keepachangelog.com/en/1.0.0/">https://keepachangelog.com/en/1.0.0/</a>). Only include the categories you need for that release.</p><br />
<pre><code>**v[MAJOR.MINOR.PATCH] - YYYY-MM-DD**<br />
<br />
### Added<br />
- New feature A.<br />
- New feature B.<br />
<br />
### Changed<br />
- Updated user dashboard for better UX.<br />
- Switched payment provider logic.<br />
<br />
### Fixed<br />
- Resolved login bug affecting Safari users.<br />
<br />
### Removed<br />
- Deprecated the old reporting feature.</code></pre><br />
</li><br />
<li><br />
<p><strong>Be Concise and User-Focused:</strong> Describe the <em>impact</em> of the change, not just the code that was altered.</p><br />
<ul><br />
<li><strong>Good:</strong> "Added email notifications for successful payments."</li><br />
<li><strong>Bad:</strong> "Modified the <code>PaymentsController</code> and created a <code>PaymentNotification</code> class.""</li><br />
</ul><br />
</li><br />
</ol>